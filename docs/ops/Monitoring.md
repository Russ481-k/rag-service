# 모니터링 및 운영 계획

본 문서는 서비스 배포 후 안정적인 운영을 위한 로깅, 모니터링, 알림 정책을 정의합니다.

## 1. 로깅 (Logging)

- **목표**: 문제 발생 시 원인을 신속하게 파악하고, 사용자 요청 흐름을 추적할 수 있도록 유의미한 정보를 기록합니다.
- **로깅 정책**:
  - **포맷**: 모든 로그는 **JSON 형식**으로 출력하여 기계적인 분석이 용이하도록 합니다. (e.g., `python-json-logger`)
  - **로그 레벨**:
    - `INFO`: 사용자 요청 처리, Celery 작업 시작/종료 등 주요 이벤트 기록.
    - `WARNING`: 잠재적 문제가 될 수 있는 상황 기록 (e.g., 외부 API 응답 지연).
    - `ERROR`: 처리되지 않은 예외 발생, 요청 처리 실패 등 즉각적인 확인이 필요한 오류 기록.
  - **포함 정보**: `timestamp`, `level`, `message`, `request_id`, `user_id` (인증 도입 시) 등 컨텍스트를 파악할 수 있는 정보를 포함합니다.

## 2. 메트릭 (Metrics) & 대시보드

- **목표**: 서비스의 전반적인 상태와 성능을 시각적으로 파악하고 이상 징후를 조기에 발견합니다.
- **핵심 성능 지표 (KPIs)**:
  - **API 서버 (FastAPI)**:
    - 요청 지연 시간 (Latency): 95th, 99th percentile
    - 요청 처리량 (Throughput): RPM (Requests Per Minute)
    - 에러율 (Error Rate): 4xx, 5xx 응답 비율
  - **작업 큐 (Celery & Redis)**:
    - 큐에 대기중인 작업 수 (Queue Length)
    - 작업 처리 시간 (Task Execution Time)
    - 실패한 작업 수
  - **LLM (Jemini)**:
    - 응답 생성 시간
    - Token 사용량
- **도구**: `Prometheus`를 사용하여 메트릭을 수집하고, `Grafana`를 통해 위 지표들을 시각화하는 대시보드를 구성하는 것을 권장합니다.

## 3. 알림 (Alerting)

- **목표**: 시스템에 심각한 문제가 발생했을 때 개발자가 즉시 인지하고 대응할 수 있도록 자동 알림을 설정합니다.
- **알림 규칙 (예시)**:
  - `CRITICAL`: 5분간 5xx 에러율이 5% 이상일 경우
  - `WARNING`: Celery 큐에 작업이 100개 이상 쌓였을 경우
  - `INFO`: 새로운 버전이 성공적으로 배포되었을 경우
- **알림 채널**: `Slack`, 이메일 등 개발팀이 빠르게 확인할 수 있는 채널을 사용합니다.
